"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var Rx_1 = require("rxjs/Rx");
var kinvey_nativescript_sdk_1 = require("kinvey-nativescript-sdk");
var config_1 = require("../../shared/config");
var car_model_1 = require("./car.model");
var fs = require("file-system");
var editableProperties = [
    "class",
    "doors",
    "hasAC",
    "transmission",
    "luggage",
    "name",
    "price",
    "seats",
    "imageUrl"
];
var CarService = /** @class */ (function () {
    function CarService() {
        this.allCars = [];
        this.carsStore = kinvey_nativescript_sdk_1.Kinvey.DataStore.collection("cars");
    }
    CarService_1 = CarService;
    CarService.cloneUpdateModel = function (car) {
        return editableProperties.reduce(function (a, e) { return (a[e] = car[e], a); }, { _id: car.id });
    };
    CarService.prototype.getCarById = function (id) {
        if (!id) {
            return;
        }
        return this.allCars.filter(function (car) {
            return car.id === id;
        })[0];
    };
    CarService.prototype.load = function () {
        var _this = this;
        return new Rx_1.Observable(function (observer) {
            _this.login().then(function () {
                return _this.carsStore.sync();
            }).then(function () {
                var sortByNameQuery = new kinvey_nativescript_sdk_1.Kinvey.Query();
                sortByNameQuery.ascending("name");
                var stream = _this.carsStore.find(sortByNameQuery);
                return stream.toPromise();
            }).then(function (data) {
                _this.allCars = [];
                data.forEach(function (carData) {
                    carData.id = carData._id;
                    var car = new car_model_1.Car(carData);
                    _this.allCars.push(car);
                });
                observer.next(_this.allCars);
            }).catch(_this.handleErrors);
        });
    };
    CarService.prototype.update = function (carModel) {
        var updateModel = CarService_1.cloneUpdateModel(carModel);
        return this.carsStore.save(updateModel);
    };
    CarService.prototype.uploadImage = function (remoteFullPath, localFullPath) {
        var imageFile = fs.File.fromPath(localFullPath);
        var imageContent = imageFile.readSync();
        var metadata = {
            filename: imageFile.name,
            mimeType: this.getMimeType(imageFile.extension),
            size: imageContent.length,
            public: true
        };
        return kinvey_nativescript_sdk_1.Kinvey.Files.upload(imageFile, metadata, { timeout: 2147483647 })
            .then(function (uploadedFile) {
            var query = new kinvey_nativescript_sdk_1.Kinvey.Query();
            query.equalTo("_id", uploadedFile._id);
            return kinvey_nativescript_sdk_1.Kinvey.Files.find(query);
        })
            .then(function (files) {
            if (files && files.length) {
                var file = files[0];
                file.url = file._downloadURL;
                return file;
            }
            else {
                Promise.reject(new Error("No items with the given ID could be found."));
            }
        });
    };
    CarService.prototype.login = function () {
        if (!!kinvey_nativescript_sdk_1.Kinvey.User.getActiveUser()) {
            return Promise.resolve();
        }
        else {
            return kinvey_nativescript_sdk_1.Kinvey.User.login(config_1.Config.kinveyUsername, config_1.Config.kinveyPassword);
        }
    };
    CarService.prototype.handleErrors = function (error) {
        console.log(error);
        return Rx_1.Observable.throw(error);
    };
    CarService.prototype.getMimeType = function (imageExtension) {
        var extension = imageExtension === "jpg" ? "jpeg" : imageExtension;
        return "image/" + extension.replace(/\./g, "");
    };
    CarService = CarService_1 = __decorate([
        core_1.Injectable()
    ], CarService);
    return CarService;
    var CarService_1;
}());
exports.CarService = CarService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjYXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNDQUEyQztBQUMzQyw4QkFBcUM7QUFFckMsbUVBQWlEO0FBQ2pELDhDQUE2QztBQUM3Qyx5Q0FBa0M7QUFFbEMsZ0NBQWtDO0FBRWxDLElBQU0sa0JBQWtCLEdBQUc7SUFDdkIsT0FBTztJQUNQLE9BQU87SUFDUCxPQUFPO0lBQ1AsY0FBYztJQUNkLFNBQVM7SUFDVCxNQUFNO0lBQ04sT0FBTztJQUNQLE9BQU87SUFDUCxVQUFVO0NBQ2IsQ0FBQztBQUdGO0lBREE7UUFNWSxZQUFPLEdBQWUsRUFBRSxDQUFDO1FBQ3pCLGNBQVMsR0FBRyxnQ0FBTSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQU0sTUFBTSxDQUFDLENBQUM7SUEyRmpFLENBQUM7bUJBakdZLFVBQVU7SUFDSiwyQkFBZ0IsR0FBL0IsVUFBZ0MsR0FBUTtRQUNwQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDLFVBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSyxPQUFBLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBbEIsQ0FBa0IsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNwRixDQUFDO0lBS0QsK0JBQVUsR0FBVixVQUFXLEVBQVU7UUFDakIsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ04sTUFBTSxDQUFDO1FBQ1gsQ0FBQztRQUVELE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxVQUFDLEdBQUc7WUFDM0IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDO1FBQ3pCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lB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QUU3QixNQUFNLENBQUMsSUFBSSxDQUFDO1lBQ2hCLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDSixPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxDQUFDLDRDQUE0QyxDQUFDLENBQUMsQ0FBQztZQUM1RSxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDWCxDQUFDO0lBRU8sMEJBQUssR0FBYjtRQUNJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxnQ0FBTSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDaEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUM3QixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDSixNQUFNLENBQUMsZ0NBQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGVBQU0sQ0FBQyxjQUFjLEVBQUUsZUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQzNFLENBQUM7SUFDTCxDQUFDO0lBRU8saUNBQVksR0FBcEIsVUFBcUIsS0FBZTtRQUNoQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRW5CLE1BQU0sQ0FBQyxlQUFVLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ25DLENBQUM7SUFFTyxnQ0FBVyxHQUFuQixVQUFvQixjQUFzQjtRQUN0QyxJQUFNLFNBQVMsR0FBRyxjQUFjLEtBQUssS0FBSyxHQUFHLE1BQU0sR0FBRyxjQUFjLENBQUM7UUFFckUsTUFBTSxDQUFDLFFBQVEsR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBaEdRLFVBQVU7UUFEdEIsaUJBQVUsRUFBRTtPQUNBLFVBQVUsQ0FpR3RCO0lBQUQsaUJBQUM7O0NBQUEsQUFqR0QsSUFpR0M7QUFqR1ksZ0NBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqcy9SeFwiO1xuXG5pbXBvcnQgeyBLaW52ZXkgfSBmcm9tIFwia2ludmV5LW5hdGl2ZXNjcmlwdC1zZGtcIjtcbmltcG9ydCB7IENvbmZpZyB9IGZyb20gXCIuLi8uLi9zaGFyZWQvY29uZmlnXCI7XG5pbXBvcnQgeyBDYXIgfSBmcm9tIFwiLi9jYXIubW9kZWxcIjtcblxuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZpbGUtc3lzdGVtXCI7XG5cbmNvbnN0IGVkaXRhYmxlUHJvcGVydGllcyA9IFtcbiAgICBcImNsYXNzXCIsXG4gICAgXCJkb29yc1wiLFxuICAgIFwiaGFzQUNcIixcbiAgICBcInRyYW5zbWlzc2lvblwiLFxuICAgIFwibHVnZ2FnZVwiLFxuICAgIFwibmFtZVwiLFxuICAgIFwicHJpY2VcIixcbiAgICBcInNlYXRzXCIsXG4gICAgXCJpbWFnZVVybFwiXG5dO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQ2FyU2VydmljZSB7XG4gICAgcHJpdmF0ZSBzdGF0aWMgY2xvbmVVcGRhdGVNb2RlbChjYXI6IENhcik6IG9iamVjdCB7XG4gICAgICAgIHJldHVybiBlZGl0YWJsZVByb3BlcnRpZXMucmVkdWNlKChhLCBlKSA9PiAoYVtlXSA9IGNhcltlXSwgYSksIHsgX2lkOiBjYXIuaWQgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhbGxDYXJzOiBBcnJheTxDYXI+ID0gW107XG4gICAgcHJpdmF0ZSBjYXJzU3RvcmUgPSBLaW52ZXkuRGF0YVN0b3JlLmNvbGxlY3Rpb248YW55PihcImNhcnNcIik7XG5cbiAgICBnZXRDYXJCeUlkKGlkOiBzdHJpbmcpOiBDYXIge1xuICAgICAgICBpZiAoIWlkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5hbGxDYXJzLmZpbHRlcigoY2FyKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gY2FyLmlkID09PSBpZDtcbiAgICAgICAgfSlbMF07XG4gICAgfVxuXG4gICAgbG9hZCgpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGUoKG9ic2VydmVyOiBhbnkpID0+IHtcbiAgICAgICAgICAgIHRoaXMubG9naW4oKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jYXJzU3RvcmUuc3luYygpO1xuICAgICAgICAgICAgfSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc29ydEJ5TmFtZVF1ZXJ5ID0gbmV3IEtpbnZleS5RdWVyeSgpO1xuICAgICAgICAgICAgICAgIHNvcnRCeU5hbWVRdWVyeS5hc2NlbmRpbmcoXCJuYW1lXCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMuY2Fyc1N0b3JlLmZpbmQoc29ydEJ5TmFtZVF1ZXJ5KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBzdHJlYW0udG9Qcm9taXNlKCk7XG4gICAgICAgICAgICB9KS50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGxDYXJzID0gW107XG4gICAgICAgICAgICAgICAgZGF0YS5mb3JFYWNoKChjYXJEYXRhOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY2FyRGF0YS5pZCA9IGNhckRhdGEuX2lkO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjYXIgPSBuZXcgQ2FyKGNhckRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWxsQ2Fycy5wdXNoKGNhcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBvYnNlcnZlci5uZXh0KHRoaXMuYWxsQ2Fycyk7XG4gICAgICAgICAgICB9KS5jYXRjaCh0aGlzLmhhbmRsZUVycm9ycyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHVwZGF0ZShjYXJNb2RlbDogQ2FyKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgY29uc3QgdXBkYXRlTW9kZWwgPSBDYXJTZXJ2aWNlLmNsb25lVXBkYXRlTW9kZWwoY2FyTW9kZWwpO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmNhcnNTdG9yZS5zYXZlKHVwZGF0ZU1vZGVsKTtcbiAgICB9XG5cbiAgICB1cGxvYWRJbWFnZShyZW1vdGVGdWxsUGF0aDogc3RyaW5nLCBsb2NhbEZ1bGxQYXRoOiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICBjb25zdCBpbWFnZUZpbGUgPSBmcy5GaWxlLmZyb21QYXRoKGxvY2FsRnVsbFBhdGgpO1xuICAgICAgICBjb25zdCBpbWFnZUNvbnRlbnQgPSBpbWFnZUZpbGUucmVhZFN5bmMoKTtcblxuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IHtcbiAgICAgICAgICAgIGZpbGVuYW1lOiBpbWFnZUZpbGUubmFtZSxcbiAgICAgICAgICAgIG1pbWVUeXBlOiB0aGlzLmdldE1pbWVUeXBlKGltYWdlRmlsZS5leHRlbnNpb24pLFxuICAgICAgICAgICAgc2l6ZTogaW1hZ2VDb250ZW50Lmxlbmd0aCxcbiAgICAgICAgICAgIHB1YmxpYzogdHJ1ZVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBLaW52ZXkuRmlsZXMudXBsb2FkKGltYWdlRmlsZSwgbWV0YWRhdGEsIHsgdGltZW91dDogMjE0NzQ4MzY0NyB9KVxuICAgICAgICAgICAgLnRoZW4oKHVwbG9hZGVkRmlsZTogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcXVlcnkgPSBuZXcgS2ludmV5LlF1ZXJ5KCk7XG4gICAgICAgICAgICAgICAgcXVlcnkuZXF1YWxUbyhcIl9pZFwiLCB1cGxvYWRlZEZpbGUuX2lkKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBLaW52ZXkuRmlsZXMuZmluZChxdWVyeSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oKGZpbGVzOiBBcnJheTxhbnk+KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGVzICYmIGZpbGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gZmlsZXNbMF07XG4gICAgICAgICAgICAgICAgICAgIGZpbGUudXJsID0gZmlsZS5fZG93bmxvYWRVUkw7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbGU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiTm8gaXRlbXMgd2l0aCB0aGUgZ2l2ZW4gSUQgY291bGQgYmUgZm91bmQuXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGxvZ2luKCk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGlmICghIUtpbnZleS5Vc2VyLmdldEFjdGl2ZVVzZXIoKSkge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIEtpbnZleS5Vc2VyLmxvZ2luKENvbmZpZy5raW52ZXlVc2VybmFtZSwgQ29uZmlnLmtpbnZleVBhc3N3b3JkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlRXJyb3JzKGVycm9yOiBSZXNwb25zZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG5cbiAgICAgICAgcmV0dXJuIE9ic2VydmFibGUudGhyb3coZXJyb3IpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0TWltZVR5cGUoaW1hZ2VFeHRlbnNpb246IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IGltYWdlRXh0ZW5zaW9uID09PSBcImpwZ1wiID8gXCJqcGVnXCIgOiBpbWFnZUV4dGVuc2lvbjtcblxuICAgICAgICByZXR1cm4gXCJpbWFnZS9cIiArIGV4dGVuc2lvbi5yZXBsYWNlKC9cXC4vZywgXCJcIik7XG4gICAgfVxufVxuIl19