"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var utils = require("utils/utils");
var ItemsComponent = (function () {
    function ItemsComponent() {
        this.states = ["unknown", "start", "change", "end"];
        this.startScale = 1;
    }
    ItemsComponent.prototype.ngOnInit = function () {
        console.log("page loaded");
        this.item = this.nativeItem.nativeElement;
        this.statusLbl = this.status.nativeElement;
        this.density = utils.layout.getDisplayDensity();
        this.item.translateX = 0;
        this.item.translateY = 0;
        this.item.scaleX = 1;
        this.item.scaleY = 1;
        this.updateStatus();
    };
    ItemsComponent.prototype.onPan = function (args) {
        console.log("PAN[" + this.states[args.state] + "] deltaX: " + Math.round(args.deltaX) + " deltaY: " + Math.round(args.deltaY));
        if (args.state === 1) {
            this.prevDeltaX = 0;
            this.prevDeltaY = 0;
        }
        else if (args.state === 2) {
            this.item.translateX += args.deltaX - this.prevDeltaX;
            this.item.translateY += args.deltaY - this.prevDeltaY;
            this.prevDeltaX = args.deltaX;
            this.prevDeltaY = args.deltaY;
        }
        this.updateStatus();
    };
    ItemsComponent.prototype.onPinch = function (args) {
        console.log("PINCH[" + this.states[args.state] + "] scale: " + args.scale + " focusX: " + args.getFocusX() + " focusY: " + args.getFocusY());
        if (args.state === 1) {
            var newOriginX = args.getFocusX() - this.item.translateX;
            var newOriginY = args.getFocusY() - this.item.translateY;
            var oldOriginX = this.item.originX * this.item.getMeasuredWidth();
            var oldOriginY = this.item.originY * this.item.getMeasuredHeight();
            this.item.translateX += (oldOriginX - newOriginX) * (1 - this.item.scaleX);
            this.item.translateY += (oldOriginY - newOriginY) * (1 - this.item.scaleY);
            this.item.originX = newOriginX / this.item.getMeasuredWidth();
            this.item.originY = newOriginY / this.item.getMeasuredHeight();
            this.startScale = this.item.scaleX;
        }
        else if (args.scale && args.scale !== 1) {
            var newScale = this.startScale * args.scale;
            newScale = Math.min(8, newScale);
            newScale = Math.max(0.125, newScale);
            this.item.scaleX = newScale;
            this.item.scaleY = newScale;
        }
    };
    ItemsComponent.prototype.onDoubleTap = function (args) {
        var _this = this;
        console.log("DOUBLETAP");
        this.item.animate({
            translate: { x: 0, y: 0 },
            scale: { x: 1, y: 1 },
            curve: "easeOut",
            duration: 300
        }).then(function () {
            _this.updateStatus();
        });
        this.updateStatus();
    };
    ItemsComponent.prototype.updateStatus = function () {
        var text = "translate: [" + Math.round(this.item.translateX) + ", " + Math.round(this.item.translateY) + "]" +
            "\nscale: [" + (Math.round(this.item.scaleX * 100) / 100) + ", " + (Math.round(this.item.scaleY * 100) / 100) + "]" +
            "\norigin: [" + Math.round(this.item.originX * this.item.getMeasuredWidth()) + ", " + Math.round(this.item.originY * this.item.getMeasuredHeight()) + "]";
        this.statusLbl.text = text;
    };
    __decorate([
        core_1.ViewChild("item"),
        __metadata("design:type", core_1.ElementRef)
    ], ItemsComponent.prototype, "nativeItem", void 0);
    __decorate([
        core_1.ViewChild("status"),
        __metadata("design:type", core_1.ElementRef)
    ], ItemsComponent.prototype, "status", void 0);
    ItemsComponent = __decorate([
        core_1.Component({
            selector: "ns-items",
            moduleId: module.id,
            templateUrl: "./items.component.html",
        }),
        __metadata("design:paramtypes", [])
    ], ItemsComponent);
    return ItemsComponent;
}());
exports.ItemsComponent = ItemsComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXRlbXMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaXRlbXMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQWlFO0FBTWpFLG1DQUFxQztBQVNyQztJQWNJO1FBYkMsV0FBTSxHQUFHLENBQUMsU0FBUyxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFXL0MsZUFBVSxHQUFHLENBQUMsQ0FBQztJQUVBLENBQUM7SUFFakIsaUNBQVEsR0FBUjtRQUNJLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUM7UUFFM0IsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQztRQUMxQyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDO1FBRTNDLElBQUksQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBRWhELElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQztRQUN6QixJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7UUFDekIsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQ3JCLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztRQUVyQixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDeEIsQ0FBQztJQUVELDhCQUFLLEdBQUwsVUFBTSxJQUF5QjtRQUMzQixPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxZQUFZLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFFL0gsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25CLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDO1lBQ3BCLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDO1FBQ3hCLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFCLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQztZQUN0RCxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUM7WUFFdEQsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQzlCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUNsQyxDQUFDO1FBRUQsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFFRCxnQ0FBTyxHQUFQLFVBQVEsSUFBMkI7UUFDL0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLEdBQUcsV0FBVyxHQUFHLElBQUksQ0FBQyxTQUFTLEVBQUUsR0FBRyxXQUFXLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUM7UUFFN0ksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25CLElBQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxTQUFTLEVBQUUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQztZQUMzRCxJ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QUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHO1lBQ25ILGFBQWEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxHQUFHLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FBQztRQUUxSixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDbkMsQ0FBQztJQTlGbUI7UUFBbEIsZ0JBQVMsQ0FBQyxNQUFNLENBQUM7a0NBQWEsaUJBQVU7c0RBQUM7SUFHckI7UUFBcEIsZ0JBQVMsQ0FBQyxRQUFRLENBQUM7a0NBQVMsaUJBQVU7a0RBQUM7SUFOaEMsY0FBYztRQUwxQixnQkFBUyxDQUFDO1lBQ1AsUUFBUSxFQUFFLFVBQVU7WUFDcEIsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1lBQ25CLFdBQVcsRUFBRSx3QkFBd0I7U0FDeEMsQ0FBQzs7T0FDVyxjQUFjLENBa0cxQjtJQUFELHFCQUFDO0NBQUEsQUFsR0QsSUFrR0M7QUFsR1ksd0NBQWMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBFdmVudERhdGEgfSBmcm9tICdkYXRhL29ic2VydmFibGUnO1xuaW1wb3J0IHsgUGFnZSB9IGZyb20gJ3VpL3BhZ2UnO1xuaW1wb3J0IHsgTGFiZWwgfSBmcm9tIFwidWkvbGFiZWxcIjtcbmltcG9ydCB7IFZpZXcgfSBmcm9tIFwidWkvY29yZS92aWV3XCI7XG5cbmltcG9ydCAqIGFzIHV0aWxzIGZyb20gXCJ1dGlscy91dGlsc1wiO1xuaW1wb3J0IHsgR2VzdHVyZUV2ZW50RGF0YSwgUGluY2hHZXN0dXJlRXZlbnREYXRhLCBQYW5HZXN0dXJlRXZlbnREYXRhIH0gZnJvbSBcInVpL2dlc3R1cmVzXCI7XG5cblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6IFwibnMtaXRlbXNcIixcbiAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICAgIHRlbXBsYXRlVXJsOiBcIi4vaXRlbXMuY29tcG9uZW50Lmh0bWxcIixcbn0pXG5leHBvcnQgY2xhc3MgSXRlbXNDb21wb25lbnQge1xuICAgICBzdGF0ZXMgPSBbXCJ1bmtub3duXCIsIFwic3RhcnRcIiwgXCJjaGFuZ2VcIiwgXCJlbmRcIl07XG4gICAgXG4gICAgIEBWaWV3Q2hpbGQoXCJpdGVtXCIpIG5hdGl2ZUl0ZW06IEVsZW1lbnRSZWY7XG4gICAgIGl0ZW06IFZpZXc7XG5cbiAgICAgQFZpZXdDaGlsZChcInN0YXR1c1wiKSBzdGF0dXM6IEVsZW1lbnRSZWY7XG4gICAgIHN0YXR1c0xibDogTGFiZWw7XG4gICAgXG4gICAgIGRlbnNpdHk6IG51bWJlcjtcbiAgICAgcHJldkRlbHRhWDogbnVtYmVyO1xuICAgICBwcmV2RGVsdGFZOiBudW1iZXI7XG4gICAgIHN0YXJ0U2NhbGUgPSAxO1xuICAgIFxuICAgIGNvbnN0cnVjdG9yKCkgeyB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJwYWdlIGxvYWRlZFwiKTtcblxuICAgICAgICB0aGlzLml0ZW0gPSB0aGlzLm5hdGl2ZUl0ZW0ubmF0aXZlRWxlbWVudDtcbiAgICAgICAgdGhpcy5zdGF0dXNMYmwgPSB0aGlzLnN0YXR1cy5uYXRpdmVFbGVtZW50O1xuICAgICAgICBcbiAgICAgICAgdGhpcy5kZW5zaXR5ID0gdXRpbHMubGF5b3V0LmdldERpc3BsYXlEZW5zaXR5KCk7XG4gICAgXG4gICAgICAgIHRoaXMuaXRlbS50cmFuc2xhdGVYID0gMDtcbiAgICAgICAgdGhpcy5pdGVtLnRyYW5zbGF0ZVkgPSAwO1xuICAgICAgICB0aGlzLml0ZW0uc2NhbGVYID0gMTtcbiAgICAgICAgdGhpcy5pdGVtLnNjYWxlWSA9IDE7XG4gICAgXG4gICAgICAgIHRoaXMudXBkYXRlU3RhdHVzKCk7XG4gICAgfVxuXG4gICAgb25QYW4oYXJnczogUGFuR2VzdHVyZUV2ZW50RGF0YSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlBBTltcIiArIHRoaXMuc3RhdGVzW2FyZ3Muc3RhdGVdICsgXCJdIGRlbHRhWDogXCIgKyBNYXRoLnJvdW5kKGFyZ3MuZGVsdGFYKSArIFwiIGRlbHRhWTogXCIgKyBNYXRoLnJvdW5kKGFyZ3MuZGVsdGFZKSk7XG4gICAgXG4gICAgICAgIGlmIChhcmdzLnN0YXRlID09PSAxKSB7XG4gICAgICAgICAgICB0aGlzLnByZXZEZWx0YVggPSAwO1xuICAgICAgICAgICAgdGhpcy5wcmV2RGVsdGFZID0gMDtcbiAgICAgICAgfSBlbHNlIGlmIChhcmdzLnN0YXRlID09PSAyKSB7XG4gICAgICAgICAgICB0aGlzLml0ZW0udHJhbnNsYXRlWCArPSBhcmdzLmRlbHRhWCAtIHRoaXMucHJldkRlbHRhWDtcbiAgICAgICAgICAgIHRoaXMuaXRlbS50cmFuc2xhdGVZICs9IGFyZ3MuZGVsdGFZIC0gdGhpcy5wcmV2RGVsdGFZO1xuICAgIFxuICAgICAgICAgICAgdGhpcy5wcmV2RGVsdGFYID0gYXJncy5kZWx0YVg7XG4gICAgICAgICAgICB0aGlzLnByZXZEZWx0YVkgPSBhcmdzLmRlbHRhWTtcbiAgICAgICAgfVxuICAgIFxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXR1cygpO1xuICAgIH1cbiAgICBcbiAgICBvblBpbmNoKGFyZ3M6IFBpbmNoR2VzdHVyZUV2ZW50RGF0YSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlBJTkNIW1wiICsgdGhpcy5zdGF0ZXNbYXJncy5zdGF0ZV0gKyBcIl0gc2NhbGU6IFwiICsgYXJncy5zY2FsZSArIFwiIGZvY3VzWDogXCIgKyBhcmdzLmdldEZvY3VzWCgpICsgXCIgZm9jdXNZOiBcIiArIGFyZ3MuZ2V0Rm9jdXNZKCkpO1xuICAgIFxuICAgICAgICBpZiAoYXJncy5zdGF0ZSA9PT0gMSkge1xuICAgICAgICAgICAgY29uc3QgbmV3T3JpZ2luWCA9IGFyZ3MuZ2V0Rm9jdXNYKCkgLSB0aGlzLml0ZW0udHJhbnNsYXRlWDtcbiAgICAgICAgICAgIGNvbnN0IG5ld09yaWdpblkgPSBhcmdzLmdldEZvY3VzWSgpIC0gdGhpcy5pdGVtLnRyYW5zbGF0ZVk7XG4gICAgXG4gICAgICAgICAgICBjb25zdCBvbGRPcmlnaW5YID0gdGhpcy5pdGVtLm9yaWdpblggKiB0aGlzLml0ZW0uZ2V0TWVhc3VyZWRXaWR0aCgpO1xuICAgICAgICAgICAgY29uc3Qgb2xkT3JpZ2luWSA9IHRoaXMuaXRlbS5vcmlnaW5ZICogdGhpcy5pdGVtLmdldE1lYXN1cmVkSGVpZ2h0KCk7XG4gICAgXG4gICAgICAgICAgICB0aGlzLml0ZW0udHJhbnNsYXRlWCArPSAob2xkT3JpZ2luWCAtIG5ld09yaWdpblgpICogKDEgLSB0aGlzLml0ZW0uc2NhbGVYKTtcbiAgICAgICAgICAgIHRoaXMuaXRlbS50cmFuc2xhdGVZICs9IChvbGRPcmlnaW5ZIC0gbmV3T3JpZ2luWSkgKiAoMSAtIHRoaXMuaXRlbS5zY2FsZVkpO1xuICAgIFxuICAgICAgICAgICAgdGhpcy5pdGVtLm9yaWdpblggPSBuZXdPcmlnaW5YIC8gdGhpcy5pdGVtLmdldE1lYXN1cmVkV2lkdGgoKTtcbiAgICAgICAgICAgIHRoaXMuaXRlbS5vcmlnaW5ZID0gbmV3T3JpZ2luWSAvIHRoaXMuaXRlbS5nZXRNZWFzdXJlZEhlaWdodCgpO1xuICAgIFxuICAgICAgICAgICAgdGhpcy5zdGFydFNjYWxlID0gdGhpcy5pdGVtLnNjYWxlWDtcbiAgICAgICAgfSBlbHNlIGlmIChhcmdzLnNjYWxlICYmIGFyZ3Muc2NhbGUgIT09IDEpIHtcbiAgICAgICAgICAgIGxldCBuZXdTY2FsZSA9IHRoaXMuc3RhcnRTY2FsZSAqIGFyZ3Muc2NhbGU7XG4gICAgICAgICAgICBuZXdTY2FsZSA9IE1hdGgubWluKDgsIG5ld1NjYWxlKTtcbiAgICAgICAgICAgIG5ld1NjYWxlID0gTWF0aC5tYXgoMC4xMjUsIG5ld1NjYWxlKTtcbiAgICBcbiAgICAgICAgICAgIHRoaXMuaXRlbS5zY2FsZVggPSBuZXdTY2FsZTtcbiAgICAgICAgICAgIHRoaXMuaXRlbS5zY2FsZVkgPSBuZXdTY2FsZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBvbkRvdWJsZVRhcChhcmdzOiBHZXN0dXJlRXZlbnREYXRhKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiRE9VQkxFVEFQXCIpO1xuICAgIFxuICAgICAgICB0aGlzLml0ZW0uYW5pbWF0ZSh7XG4gICAgICAgICAgICB0cmFuc2xhdGU6IHsgeDogMCwgeTogMCB9LFxuICAgICAgICAgICAgc2NhbGU6IHsgeDogMSwgeTogMSB9LFxuICAgICAgICAgICAgY3VydmU6IFwiZWFzZU91dFwiLFxuICAgICAgICAgICAgZHVyYXRpb246IDMwMFxuICAgICAgICB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdHVzKCk7XG4gICAgICAgIH0pO1xuICAgIFxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXR1cygpO1xuICAgIH1cbiAgICBcbiAgICB1cGRhdGVTdGF0dXMoKSB7XG4gICAgICAgIGNvbnN0IHRleHQgPSBcInRyYW5zbGF0ZTogW1wiICsgTWF0aC5yb3VuZCh0aGlzLml0ZW0udHJhbnNsYXRlWCkgKyBcIiwgXCIgKyBNYXRoLnJvdW5kKHRoaXMuaXRlbS50cmFuc2xhdGVZKSArIFwiXVwiICtcbiAgICAgICAgICAgIFwiXFxuc2NhbGU6IFtcIiArIChNYXRoLnJvdW5kKHRoaXMuaXRlbS5zY2FsZVggKiAxMDApIC8gMTAwKSArIFwiLCBcIiArIChNYXRoLnJvdW5kKHRoaXMuaXRlbS5zY2FsZVkgKiAxMDApIC8gMTAwKSArIFwiXVwiICtcbiAgICAgICAgICAgIFwiXFxub3JpZ2luOiBbXCIgKyBNYXRoLnJvdW5kKHRoaXMuaXRlbS5vcmlnaW5YICogdGhpcy5pdGVtLmdldE1lYXN1cmVkV2lkdGgoKSkgKyBcIiwgXCIgKyBNYXRoLnJvdW5kKHRoaXMuaXRlbS5vcmlnaW5ZICogdGhpcy5pdGVtLmdldE1lYXN1cmVkSGVpZ2h0KCkpICsgXCJdXCI7XG4gICAgXG4gICAgICAgICAgICB0aGlzLnN0YXR1c0xibC50ZXh0ID0gdGV4dDtcbiAgICB9XG59Il19